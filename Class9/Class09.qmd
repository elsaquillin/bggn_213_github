---
title: "Class 09"
author: "Elsa Quillin (PID: A69043008)"
format: html
---

## The PDB database

```{r}
library(readr)

stats <- read_csv("Data Export Summary.csv")
stats

```

> Q1: What percentage of structures in the PDB are solved by X-Ray and Electron Microscopy.

```{r}
Xray <- sum( stats$`X-ray`)
EM <- sum(stats$EM)
Total <- sum( stats$Total)

(Xray/Total)*100
(EM/Total)*100

((Xray+EM)/Total)*100

```


> Q2: What proportion of structures in the PDB are protein?

```{r}

protein <- sum(stats[1, 2:(ncol(stats) - 1)])

protein/Total

```
> Make a bar plot overview.

```{r}
library(ggplot2)

ggplot(stats) + 
  aes(x = reorder(`Molecular Type`, -Total), y = Total, fill = `Molecular Type`) + 
  geom_col(width = 0.7) +
  labs(
    title = "Total structures by Molecular Type",
    x = "Molecular Type",
    y = "Number of Structures",
    fill = "Method")
```




> Q3: Type HIV in the PDB website search box on the home page and determine how many HIV-1 protease structures are in the current PDB?

There are currently 2,406 hits for HIV-1 protease structures

## Visualizing structure data

The Mol* viewer is embedded in many bioinformatics website. The homepage is https://molstar.org/

I can insert any figure or image file using markdown format

![The HIV-Pr dimer with bound inhibitor](1HSG.png)

## Bio3D package for structural bioinformatics

We can use the bio3d package to read and analyze biomolecular data in R
```{r}
library(bio3d)

hiv <- read.pdb("1hsg")
hiv
```

```{r}
head(hiv$atom)
```


Let's get the sequence
```{r}
pdbseq(hiv)
```

Let's trim to chain A and just get it's sequence:

```{r}
chainA<-trim.pdb(hiv, chain="A")
chainA.seq <-pdbseq(chainA)
```
Let's blast

```{r blast_hiv, cache=TRUE}
blast <- blast.pdb(chainA.seq)
```

```{r}
head(blast$hit.tbl)
```

Plot a quick overview of blast results

```{r}
hits <- plot(blast)
```
```{r}
hits$pdb.id
```

## Prediction of functional motions

We can run a Normal Mode Analysis (NMA) to predict large scale motions/flexibility/dynamics of any biomolecule that we can read into R.

Let's look at ADK chain A only!

```{r}
adk <- read.pdb("1ake")
adk_A <- trim.pdb(adk, chain="A")
adk_A
```

```{r}
m <- nma(adk_A)
plot(m)
```

Let's write out a "trajectory" of predicted motion
```{r}
mktrj(m, file="adk_nma.pdb")
```

## Play with 3D viewing in R

We can use the new **bio3dview** package, which is not yet on CRAN, to render interactive 3D views in R and HTML quarto output reports.

To install from Github we can use the **pak** package.

```{r}
library(bio3dview)

#view.pdb(adk)
```

## Comparative analysis of protein structures

Starting with a sequence or structure ID (accession number) let's run a complete analysis pipeline.

```{r}
library(bio3d)

id <- "1ake_A"

aa <- get.seq(id)
aa
```

```{r, cache=TRUE}
blast <- blast.pdb(aa)
hits <- plot(blast)
```

```{r}
hits$pdb.id
```


Download all these "hits" that are similar to our starting id sequence

```{r}
files <- get.pdb(hits$pdb.id, path="pdbs", split=TRUE, gzip=TRUE)
```


```{r}
pdbs <- pdbaln(files, fit = TRUE, exefile="msa")
```

```{r}
pc.xray <- pca(pdbs)
plot(pc.xray)
```

```{r}
plot(pc.xray, 1:2)
```

```{r}
mktrj(pc.xray, file="pca_results.pdb")
```


```{r}
library(bio3dview)

view.pca(pc.xray)

```























